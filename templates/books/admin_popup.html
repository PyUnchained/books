{% load static crispy_forms_tags %}

<div id='popup_ajax'>
<form id = 'add_entries_form' action="/baza/">
<div class = 'half_div'>
	<h3>Debit Entries</h3>
	{% crispy debit_formset debit_form_helper %}
	<a class = 'btn-regular extra_entry_btn'><i class = 'fa fa-plus'></i></a>
</div>
<div class = 'half_div'>
	<h3>Credit Entries</h3>
	{% crispy credit_formset debit_form_helper %}
	<a class = 'btn-regular extra_entry_btn'><i class = 'fa fa-plus'></i></a>

</div>
<a href="#"></a>
<hr>
<input type="submit" value="Submit">
</form>

<script src="http://malsup.github.com/min/jquery.form.min.js" type="text/javascript"></script>
<script type="text/javascript">
	$( document ).ready(function() {

		$('.half_div').each(function() {
			var siblings = $(this).children('.formset_entry');
			var count = 0
			siblings.each(function() {
				if (count < 1) {
					count = count + 1;
				} else {
					$(this).toggle();
				}
			});
		})

		$('.extra_entry_btn').click(function() {
			var siblings = $(this).parent().children('.formset_entry');
			var found = false;
			siblings.each(function() {
				if ($(this).is(":visible")) {
					found = false;
				} else {
					if (found == false){
						$(this).toggle();
						found = true;
					}
					
				}
			});
		})
	});
</script>

<script> 
// wait for the DOM to be loaded 
$(document).ready(function() { 
	var options = { 
	        success:       showResponse,  // post-submit callback   
	 
	        // other available options: 
	        url:       '{% url "opexa_books:admin_single_entries" journal_entry.pk %}',         // override for form's 'action' attribute 
	        type:      'post',        // 'get' or 'post', override for form's 'method' attribute 
	        dataType:  'json',        // 'xml', 'script', or 'json' (expected server response type) 
	        // clearForm: true,        // clear all form fields after successful submit 
	        // resetForm: true,        // reset the form after successful submit 
	 
	        // $.ajax options can be used here too, for example: 
	        //timeout:   3000 
	    }; 
    // bind 'myForm' and provide a simple callback function 
    $('#add_entries_form').ajaxForm(options); 
});

function showResponse(responseText, statusText, xhr, $form)  { 
    // for normal html responses, the first argument to the success callback 
    // is the XMLHttpRequest object's responseText property 
 
    // if the ajaxForm method was passed an Options Object with the dataType 
    // property set to 'xml' then the first argument to the success callback 
    // is the XMLHttpRequest object's responseXML property 
 
    // if the ajaxForm method was passed an Options Object with the dataType 
    // property set to 'json' then the first argument to the success callback 
    // is the json data object returned by the server 

    console.log(responseText);
    $( "#popup_ajax" ).replaceWith(responseText['form_html']);
 
    alert('status: ' + statusText + '\n\nresponseText: \n' + responseText + 
        '\n\nThe output div should have already been updated with the responseText.'); 
} 
</script>
</div>